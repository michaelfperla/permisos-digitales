<!-- === Permit Detail View Partial (/frontend/views/permit-detail.html) === -->
<!-- All styles are now imported by main.css directly -->
<!-- We've moved individual component imports into main.css as part of our architecture improvements -->

<div class="permit-container">
    <a href="#/dashboard" class="back-link">
        <svg class="icon icon-chevron-left" focusable="false" aria-hidden="true"><use xlink:href="/assets/icons/sprite.svg?v=3.0.0#icon-chevron-left"></use></svg>
        Volver al Dashboard
    </a>

    <h2 id="detail-title" class="permit-section-title">Detalles de la Solicitud #<span id="detail-application-id">...</span></h2>

    <div id="detail-loading" class="loading-indicator">
        <div class="spinner" aria-label="Cargando detalles..."></div>
        <p>Cargando detalles...</p>
    </div>

    <div id="detail-error-message" class="message-area error-message" hidden aria-live="assertive"></div>

    <div id="detail-content" hidden>
        <!-- Status Card with Timeline -->
        <div class="permit-card">
            <section class="permit-section status-section" aria-labelledby="status-heading">
                <div class="status-header">
                    <h3 id="status-heading" class="permit-section-title">Estado Actual</h3>
                    <span id="detail-status-badge" class="status-badge">---</span>
                </div>

                <div class="status-details">
                    <p id="detail-status-description"></p>
                    <p><strong>Próximos Pasos:</strong> <em id="detail-status-next-steps">---</em></p>
                    <p><small>Última Actualización: <span id="detail-last-updated">---</span></small></p>
                </div>

                <div id="permit-actions" class="permit-actions"></div>

                <!-- Permit Timeline -->
                <div class="permit-timeline" id="permit-timeline">
                    <!-- Timeline items will be dynamically generated based on status -->
                </div>
            </section>
        </div>

        <!-- Upload Section Card -->
        <div class="permit-card" id="upload-section" hidden>
            <section class="permit-section upload-section" aria-labelledby="upload-heading">
                <h3 id="upload-heading" class="permit-section-title">Subir Comprobante de Pago</h3>

                <div class="notice notice-warning">
                    <strong>Aviso Importante:</strong> Los permisos son procesados de lunes a viernes (días hábiles).
                    Si selecciona una fecha de inicio deseada, su solicitud se enviará para verificación el día hábil
                    anterior a esa fecha. Si no selecciona una fecha, su solicitud se procesará inmediatamente.
                </div>

                <form id="upload-form" novalidate>
                    <!-- Enhanced File Upload UI -->
                    <div class="form-group">
                        <label for="payment-proof-file">Comprobante de Pago <span class="required">*</span></label>
                        <div class="file-upload-container" id="file-upload-container">
                            <div class="file-upload-icon">
                                <svg class="icon icon-upload" focusable="false" aria-hidden="true"><use xlink:href="/assets/icons/sprite.svg?v=3.0.0#icon-upload"></use></svg>
                            </div>
                            <div class="file-upload-text">
                                <strong>Arrastre su archivo aquí o haga clic para seleccionar</strong>
                                <p>Formatos aceptados: JPG, PNG, PDF (máx 5MB)</p>
                            </div>
                            <input type="file" id="payment-proof-file" name="paymentProof" class="file-upload-input" required accept="image/jpeg, image/png, application/pdf">
                        </div>
                        <div id="file-name-display" class="file-name-display" hidden>
                            <svg class="icon icon-file" focusable="false" aria-hidden="true"><use xlink:href="/assets/icons/sprite.svg?v=3.0.0#icon-file"></use></svg>
                            <span class="file-name">Nombre del archivo</span>
                            <span class="file-remove" id="file-remove">
                                <svg class="icon icon-x" focusable="false" aria-hidden="true"><use xlink:href="/assets/icons/sprite.svg?v=3.0.0#icon-x"></use></svg>
                            </span>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="payment-reference-input">Referencia de Pago (Opcional)</label>
                            <svg class="input-icon icon icon-hash" focusable="false" aria-hidden="true"><use xlink:href="/assets/icons/sprite.svg?v=3.0.0#icon-hash"></use></svg>
                            <input type="text" id="payment-reference-input" name="paymentReference" class="input-with-icon" placeholder="Ej: Folio de transferencia, # de recibo Oxxo">
                            <small class="input-help-text">Ayuda a acelerar la verificación.</small>
                        </div>

                        <div class="form-group">
                            <label for="desired-start-date">Fecha de Inicio Deseada (Opcional)</label>
                            <svg class="input-icon icon icon-calendar" focusable="false" aria-hidden="true"><use xlink:href="/assets/icons/sprite.svg?v=3.0.0#icon-calendar"></use></svg>
                            <input type="date" id="desired-start-date" name="desiredStartDate" min="" class="date-input input-with-icon">
                            <small class="input-help-text">Seleccione la fecha en que desea que inicie la validez de su permiso.</small>
                            <small id="desired-start-date-error" class="field-error" hidden></small>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" id="upload-submit-btn" class="btn btn-primary">
                            <span class="button-text">Subir Comprobante</span>
                            <div class="spinner" hidden aria-label="Subiendo..."></div>
                        </button>
                        <div id="upload-message" class="message-area upload-message" hidden></div>
                    </div>
                </form>
            </section>
        </div>

        <!-- Vehicle and Owner Information Cards -->
        <div class="permit-card">
            <div class="permit-tabs" id="detail-tabs">
                <button type="button" class="tab-button active" data-tab="vehicle">Información del Vehículo</button>
                <button type="button" class="tab-button" data-tab="owner">Información del Solicitante</button>
                <button type="button" class="tab-button" data-tab="dates">Fechas y Pago</button>
            </div>

            <div class="tab-content active" data-tab="vehicle">
                <section class="permit-section vehicle-section" aria-labelledby="vehicle-heading">
                    <h3 id="vehicle-heading" class="permit-section-title">Información del Vehículo</h3>
                    <dl class="detail-list detail-grid">
                        <div><dt>Marca:</dt><dd id="detail-vehicle-marca">---</dd></div>
                        <div><dt>Línea/Modelo:</dt><dd id="detail-vehicle-linea">---</dd></div>
                        <div><dt>Año:</dt><dd id="detail-vehicle-ano">---</dd></div>
                        <div><dt>Color:</dt><dd id="detail-vehicle-color">---</dd></div>
                        <div class="span-2"><dt>Número de Serie (VIN):</dt><dd id="detail-vehicle-serie" class="monospace-text">---</dd></div>
                        <div class="span-2"><dt>Número de Motor:</dt><dd id="detail-vehicle-motor" class="monospace-text">---</dd></div>
                    </dl>
                </section>
            </div>

            <div class="tab-content" data-tab="owner">
                <section class="permit-section owner-section" aria-labelledby="owner-heading">
                    <h3 id="owner-heading" class="permit-section-title">Información del Solicitante</h3>
                    <dl class="detail-list detail-grid">
                        <div><dt>Nombre Completo:</dt><dd id="detail-owner-name">---</dd></div>
                        <div><dt>CURP / RFC:</dt><dd id="detail-owner-curp">---</dd></div>
                        <div class="span-2"><dt>Domicilio:</dt><dd id="detail-owner-domicilio">---</dd></div>
                    </dl>
                </section>
            </div>

            <div class="tab-content" data-tab="dates">
                <section class="permit-section dates-section" aria-labelledby="dates-heading">
                    <h3 id="dates-heading" class="permit-section-title">Fechas y Pago</h3>
                    <dl class="detail-list detail-grid">
                        <div><dt>Fecha de Solicitud:</dt><dd id="detail-date-created">---</dd></div>
                        <div><dt>Comprobante Subido:</dt><dd id="detail-date-proof-uploaded">---</dd></div>
                        <div><dt>Pago Verificado:</dt><dd id="detail-date-payment-verified">---</dd></div>
                        <div><dt>Referencia de Pago (App):</dt><dd id="detail-payment-reference">---</dd></div>
                        <div id="rejection-reason-container" hidden class="span-2 rejection-reason">
                            <dt>Motivo Rechazo Pago:</dt>
                            <dd id="detail-payment-rejection"></dd>
                        </div>
                    </dl>
                </section>
            </div>
        </div>
    </div>
</div>