<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Panel administrativo de Permisos Digitales">
    <title>Admin Dashboard | Permisos Digitales</title>
    <link rel="icon" href="/assets/img/favicon.svg?v=3.0.0" type="image/svg+xml">
    <link rel="stylesheet" href="/assets/css/main.css?v=3.0.0">
    <!-- Component styles are now imported by main.css directly -->
    <script src="/assets/js/lib/chart.min.js?v=3.0.0" defer></script>
    <script src="/assets/js/utils.js?v=3.0.0" defer></script>
    <script src="/assets/js/components/admin-auth.js?v=3.0.0" defer></script>
    <script src="/assets/js/components/admin-dashboard.js?v=3.0.0" defer></script>
</head>
<body class="admin-panel">
    <div class="admin-layout">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <div class="admin-sidebar-header">
                <img src="/assets/img/logo.svg?v=3.0.0" alt="Permisos Digitales Admin" class="admin-logo">
                <button id="toggle-sidebar" class="toggle-sidebar" title="Colapsar menu">
                    <svg class="icon icon-menu"><use xlink:href="/assets/icons/sprite.svg?v=3.0.0#icon-menu"></use></svg>
                </button>
            </div>
            
            <nav class="admin-nav">
                <ul>
                    <li class="active">
                        <a href="javascript:void(0);" data-section="dashboard">
                            <svg class="icon icon-dashboard"><use xlink:href="/assets/icons/sprite.svg?v=3.0.0#icon-dashboard"></use></svg>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="javascript:void(0);" data-section="verifications">
                            <svg class="icon icon-check-circle"><use xlink:href="/assets/icons/sprite.svg?v=3.0.0#icon-check-circle"></use></svg>
                            <span>Verificaciones</span>
                        </a>
                    </li>
                    <li>
                        <a href="javascript:void(0);" data-section="applications">
                            <svg class="icon icon-document"><use xlink:href="/assets/icons/sprite.svg?v=3.0.0#icon-document"></use></svg>
                            <span>Solicitudes</span>
                        </a>
                    </li>
                    <li>
                        <a href="javascript:void(0);" data-section="users">
                            <svg class="icon icon-users"><use xlink:href="/assets/icons/sprite.svg?v=3.0.0#icon-users"></use></svg>
                            <span>Usuarios</span>
                        </a>
                    </li>
                    <li>
                        <a href="javascript:void(0);" data-section="reports">
                            <svg class="icon icon-chart"><use xlink:href="/assets/icons/sprite.svg?v=3.0.0#icon-chart"></use></svg>
                            <span>Reportes</span>
                        </a>
                    </li>
                    <li>
                        <a href="javascript:void(0);" data-section="settings">
                            <svg class="icon icon-settings"><use xlink:href="/assets/icons/sprite.svg?v=3.0.0#icon-settings"></use></svg>
                            <span>Configuración</span>
                        </a>
                    </li>
                </ul>
            </nav>
            
            <div class="sidebar-footer">
                <button id="admin-logout-btn" class="btn-logout">
                    <svg class="icon icon-logout"><use xlink:href="/assets/icons/sprite.svg?v=3.0.0#icon-logout"></use></svg>
                    <span>Cerrar Sesión</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="admin-main">
            <!-- Top Navigation Bar -->
            <header class="admin-header">
                <div class="header-left">
                    <button class="mobile-menu-toggle" title="Menú">
                        <svg class="icon icon-menu"><use xlink:href="/assets/icons/sprite.svg?v=3.0.0#icon-menu"></use></svg>
                    </button>
                    <h1>Dashboard</h1>
                </div>
                <div class="header-right">
                    <div class="admin-notification">
                        <button class="notification-btn" title="Notificaciones">
                            <svg class="icon icon-bell"><use xlink:href="/assets/icons/sprite.svg?v=3.0.0#icon-bell"></use></svg>
                            <span class="notification-badge">3</span>
                        </button>
                        <div class="notification-dropdown">
                            <div class="notification-header">
                                <h3>Notificaciones</h3>
                                <button class="mark-all-read">Marcar todas como leídas</button>
                            </div>
                            <div class="notification-list">
                                <div class="notification-item unread">
                                    <div class="notification-icon">
                                        <svg class="icon icon-check-circle"><use xlink:href="/assets/icons/sprite.svg?v=3.0.0#icon-check-circle"></use></svg>
                                    </div>
                                    <div class="notification-content">
                                        <p>Nueva solicitud de permiso pendiente</p>
                                        <span class="notification-time">Hace 5 minutos</span>
                                    </div>
                                </div>
                                <div class="notification-item unread">
                                    <div class="notification-icon">
                                        <svg class="icon icon-document"><use xlink:href="/assets/icons/sprite.svg?v=3.0.0#icon-document"></use></svg>
                                    </div>
                                    <div class="notification-content">
                                        <p>Nuevo comprobante de pago recibido</p>
                                        <span class="notification-time">Hace 30 minutos</span>
                                    </div>
                                </div>
                                <div class="notification-item">
                                    <div class="notification-icon">
                                        <svg class="icon icon-alert-circle"><use xlink:href="/assets/icons/sprite.svg?v=3.0.0#icon-alert-circle"></use></svg>
                                    </div>
                                    <div class="notification-content">
                                        <p>5 permisos expiran mañana</p>
                                        <span class="notification-time">Hace 2 horas</span>
                                    </div>
                                </div>
                            </div>
                            <div class="notification-footer">
                                <a href="javascript:void(0);" data-section="notifications">Ver todas</a>
                            </div>
                        </div>
                    </div>
                    <div class="admin-profile">
                        <span class="admin-name" id="admin-user-name">Admin Usuario</span>
                        <img src="/assets/img/favicon.svg?v=3.0.0" alt="Admin" class="admin-avatar">
                    </div>
                </div>
            </header>

            <!-- Dashboard Content -->
            <div class="admin-content">
                <!-- Dashboard Stats -->
                <section class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-icon pending">
                            <svg class="icon icon-clock"><use xlink:href="/assets/icons/sprite.svg?v=3.0.0#icon-clock"></use></svg>
                        </div>
                        <div class="stat-content">
                            <h3 id="pending-count">--</h3>
                            <p>Pendientes</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon approved">
                            <svg class="icon icon-check"><use xlink:href="/assets/icons/sprite.svg?v=3.0.0#icon-check"></use></svg>
                        </div>
                        <div class="stat-content">
                            <h3 id="approved-count">--</h3>
                            <p>Aprobados Hoy</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon rejected">
                            <svg class="icon icon-times"><use xlink:href="/assets/icons/sprite.svg?v=3.0.0#icon-times"></use></svg>
                        </div>
                        <div class="stat-content">
                            <h3 id="rejected-count">--</h3>
                            <p>Rechazados Hoy</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon total">
                            <svg class="icon icon-document"><use xlink:href="/assets/icons/sprite.svg?v=3.0.0#icon-document"></use></svg>
                        </div>
                        <div class="stat-content">
                            <h3 id="total-count">--</h3>
                            <p>Total Activos</p>
                        </div>
                    </div>
                </section>
                
                <!-- Verification Queue -->
                <section class="dashboard-section verification-queue">
                    <div class="section-header">
                        <h2>Cola de Verificaciones</h2>
                        <a href="javascript:void(0);" data-section="verifications" class="btn btn-secondary">Ver Todos</a>
                    </div>
                    
                    <div class="responsive-table">
                        <table class="admin-table" id="verification-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Solicitante</th>
                                    <th>Referencia</th>
                                    <th>Vehículo</th>
                                    <th>Fecha</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="placeholder-row">
                                    <td colspan="6" class="text-center">Cargando verificaciones pendientes...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
                
                <!-- Status Chart and Recent Activity -->
                <section class="dashboard-section status-chart">
                    <div class="section-header">
                        <h2>Estatus de Solicitudes</h2>
                    </div>
                    <div class="chart-container">
                        <canvas id="status-chart"></canvas>
                    </div>
                </section>
                
                <section class="dashboard-section recent-activity">
                    <div class="section-header">
                        <h2>Actividad Reciente</h2>
                    </div>
                    <ul class="activity-list" id="activity-list">
                        <li class="activity-item skeleton-loader">
                            <div class="activity-icon"></div>
                            <div class="activity-content">
                                <p class="skeleton-text"></p>
                                <span class="skeleton-text"></span>
                            </div>
                        </li>
                        <li class="activity-item skeleton-loader">
                            <div class="activity-icon"></div>
                            <div class="activity-content">
                                <p class="skeleton-text"></p>
                                <span class="skeleton-text"></span>
                            </div>
                        </li>
                        <li class="activity-item skeleton-loader">
                            <div class="activity-icon"></div>
                            <div class="activity-content">
                                <p class="skeleton-text"></p>
                                <span class="skeleton-text"></span>
                            </div>
                        </li>
                    </ul>
                </section>
            </div>
        </main>
    </div>

    <!-- Modal: Payment Verification -->
    <div id="verify-modal" class="admin-modal" hidden>
        <div class="modal-overlay"></div>
        <div class="modal-container">
            <div class="modal-header">
                <h3>Verificar Pago</h3>
                <button class="modal-close" data-action="close">
                    <svg class="icon icon-close"><use xlink:href="/assets/icons/sprite.svg?v=3.0.0#icon-close"></use></svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="payment-details">
                    <div class="applicant-info">
                        <h4>Información del Solicitante</h4>
                        <p><strong>Nombre:</strong> <span id="modal-applicant-name"></span></p>
                        <p><strong>Email:</strong> <span id="modal-applicant-email"></span></p>
                        <p><strong>Vehículo:</strong> <span id="modal-vehicle"></span></p>
                    </div>
                    
                    <div class="payment-info">
                        <h4>Información del Pago</h4>
                        <p><strong>Referencia:</strong> <span id="modal-reference"></span></p>
                        <p><strong>Monto:</strong> <span id="modal-amount"></span></p>
                        <p><strong>Fecha:</strong> <span id="modal-date"></span></p>
                    </div>
                </div>
                
                <div class="proof-image">
                    <h4>Comprobante de Pago</h4>
                    <div class="image-container">
                        <img id="proof-image" src="" alt="Comprobante de pago">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="verification-notes">Notas (opcional)</label>
                    <textarea id="verification-notes" rows="2" placeholder="Agregar notas sobre este pago..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <input type="hidden" id="verification-id">
                <button class="btn btn-outlined" data-action="close">Cancelar</button>
                <button class="btn btn-danger" data-action="reject">Rechazar</button>
                <button class="btn btn-primary" data-action="approve">Aprobar</button>
            </div>
        </div>
    </div>

    <!-- Modal: Rejection Reason -->
    <div id="reject-modal" class="admin-modal" hidden>
        <div class="modal-overlay"></div>
        <div class="modal-container">
            <div class="modal-header">
                <h3>Rechazar Pago</h3>
                <button class="modal-close" data-action="close">
                    <svg class="icon icon-close"><use xlink:href="/assets/icons/sprite.svg?v=3.0.0#icon-close"></use></svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="rejection-reason">Motivo de Rechazo</label>
                    <select id="rejection-reason" required>
                        <option value="">Seleccionar razón</option>
                        <option value="Comprobante ilegible">Comprobante ilegible</option>
                        <option value="Monto incorrecto">Monto incorrecto</option>
                        <option value="Referencia inválida">Referencia inválida</option>
                        <option value="Comprobante ya utilizado">Comprobante ya utilizado</option>
                        <option value="Formato de archivo incorrecto">Formato de archivo incorrecto</option>
                        <option value="Otro">Otro motivo</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="rejection-notes">Notas Adicionales</label>
                    <textarea id="rejection-notes" rows="3" placeholder="Detalles adicionales sobre el rechazo..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outlined" data-action="back">Regresar</button>
                <button class="btn btn-danger" data-action="confirm-reject">Confirmar Rechazo</button>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div class="notification-container"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Set up authentication state
            sessionStorage.setItem('portalType', 'admin');
            sessionStorage.setItem('isAdminPortal', 'true');
            sessionStorage.setItem('isAuthenticated', 'true'); // Auto-login for demo
            
            // Initialize dashboard
            if (typeof window.initAdminDashboard === 'function') {
                window.initAdminDashboard();
            } else {
                console.error('Admin dashboard initialization function not found');
            }
        });
    </script>
</body>
</html>